<!DOCTYPE html>
<html lang="fr">
<head>
  <title>C'est un mec</title>
  <%= stylesheet_link_tag    "application", :media => "all" %>
  <%= javascript_include_tag "application" %>
  <%= csrf_meta_tags %>
  <%= auto_discovery_link_tag :rss, vannes_url(:format => :rss) %>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<div id="fb-root"></div>

<div class="navbar navbar-fixed-top">
  <div class="navbar-inner">
    <div class="container">
      <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
	<span class="icon-bar"></span>
	<span class="icon-bar"></span>
	<span class="icon-bar"></span>
      </a>
    
      <%= link_to "C'est un mec", root_url, :class => "brand" %>
      
      <div class="nav-collapse">
	<ul class="nav">
	  <li class="<%= 'active' if params[:controller] == "home" %>"><%= link_to "Accueil", root_url %></li>
	  <li class="<%= 'active' if params[:order] == "last" %>"><%= link_to 'Les dernières', vannes_url(:order => 'last') %></li>
	  <li class="<%= 'active' if params[:order] == "rand" %>"><%= link_to 'Les aléatoires', vannes_url(:order => 'rand') %></li>
	  <li class="<%= 'active' if params[:order] == "best" %>"><%= link_to 'Les meilleures', vannes_url(:order => 'best') %></li>
	</ul>
	  
	<%= form_tag vannes_path, :method => :get, :class => "navbar-search pull-left" do %>
	  <%= text_field_tag :q, params[:q], :placeholder => 'Rechercher parmi les vannes ...', :class => "search-query" %><br />
	<% end %>
	
	
	<ul class="nav pull-right">
	<% if @current_membre %>
	
	  <% if @current_membre.admin %>
	    <li class="dropdown">
	    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Admin<b class="caret"></b></a>
	    <ul class="dropdown-menu">
	      <li><%= link_to validation_vannes_path do %>
		Validation <span class="badge pull-right"><%= Vanne.where("valide = ?",false).count.to_s %></span>
		<% end %>
	      </li>
	      <li><%= link_to feedbacks_path do%>
		Feedback <span class="badge pull-right"><%= Feedback.where("lu = ?",false).count.to_s %></span>
		<% end %>
	      </li>
	    </ul>
	  </li>
	  <% end %>
	
	  <li class="dropdown">
	    <a href="#" class="dropdown-toggle" data-toggle="dropdown"><%= @current_membre.pseudo %><b class="caret"></b></a>
	    <ul class="dropdown-menu">
	      <li><%= link_to membre_path(@current_membre) do %>
		<i class="icon-user"></i> Mon profil
	      <% end %></li>
	      <li><%= link_to edit_membre_path(@current_membre) do %>
		<i class="icon-pencil"></i> Modifier mon profil
	      <% end %></li>
	      <li class="divider"></li>
	      <li><%= link_to logout_url, :method => :delete do %>
		<i class="icon-off"></i> Déconnexion
	      <% end %></li>
	    </ul>
	  </li>
	  
	  <li><div>
	    <%= link_to new_vanne_path, :class => "btn btn-primary", :rel => "tooltip", :title => "Ecrire une nouvelle vanne", :data => { :placement => 'bottom', :toggle => 'modal', :target => '#new_vanne_form' }  do %><i class="icon-pencil icon-white"></i> <span class="visible-phone">Poster une vanne</span><% end %>
	  </div></li>
	
	<% else %>
	
	<li class="dropdown">
	  <a href="#" class="dropdown-toggle" data-toggle="dropdown">Connexion<b class="caret"></b></a>
	  <ul class="dropdown-menu">
	    <%= render :partial => "sessions/form", :locals => {:condensed => true} %>
	    
	    <script>$('.dropdown-menu').find('form').click(function (e) {  e.stopPropagation(); });</script>
	  </ul>
	</li>
	    
	<% end %>
	</ul>
       </div>
    </div>
  </div>
</div>

<div class="container-fluid">

<% if @current_membre %>
<div class="modal hide fade" id="new_vanne_form">
  <div class="modal-header">
    <button class="close" data-dismiss="modal">&times;</button>
    <h3>Nouvelle vanne</h3>
  </div>
  
  <%= render :partial => "vannes/form", :locals => { :modal => true } %>
</div>
<% end %>


<%= link_to new_feedback_path, :class => "feedback-button btn btn-warning btn-large hidden-phone", :data => { :toggle => 'modal', :target => '#new_feedback_form' } do %><i class="icon-exclamation-sign icon-white"></i> Feedback <% end %>

<div class="modal hide fade" id="new_feedback_form">
  <div class="modal-header">
    <button class="close" data-dismiss="modal">&times;</button>
    <h3>Question, remarque, émotion ?</h3>
  </div>
  
  <%= render :partial => "feedbacks/form", :locals => { :modal => true } %>
</div>


  <div class="alert-container">
  <% if flash[:notice] %>
    <div class="alert alert-success in">
      <a class="close">×</a>
      <%= flash[:notice] %>
    </div>
  <% elsif flash[:error] %>
    <div class="alert alert-error in">
      <a class="close">×</a>
      <%= flash[:alert] %>
    </div>
  <% end %>
  </div>



  <%= yield %>




  <hr>

  <footer>
    <p class="pull-right"><a href="#" id="scroll_to_top">Retour en haut</a></p>
    <p>
      Site réalisé par <a href="http://twitter.com/allegrem">@allegrem</a>. Tous droits réservés. <br />
      Propulsé par <a href="http://rubyonrails.org/">Ruby on Rails</a> et <a href="http://twitter.github.com/bootstrap/">Bootstrap Twitter</a>. <br />
      Icones de <a href="http://glyphicons.com">Glyphicons Free</a>, sous licence <a href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>.
    </p>
  </footer>

</div>

</body>
</html>
